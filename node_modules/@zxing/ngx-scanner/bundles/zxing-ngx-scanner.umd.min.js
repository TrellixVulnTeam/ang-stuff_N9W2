!function(e,t){"object"==typeof exports&&"undefined"!=typeof module?t(exports,require("@angular/common"),require("@angular/core"),require("@angular/forms"),require("@zxing/browser"),require("@zxing/library"),require("rxjs")):"function"==typeof define&&define.amd?define("@zxing/ngx-scanner",["exports","@angular/common","@angular/core","@angular/forms","@zxing/browser","@zxing/library","rxjs"],t):t(((e="undefined"!=typeof globalThis?globalThis:e||self).zxing=e.zxing||{},e.zxing["ngx-scanner"]={}),e.ng.common,e.ng.core,e.ng.forms,e.browser,e.library,e.rxjs)}(this,(function(e,t,n,r,i,o,s){"use strict";
/*! *****************************************************************************
    Copyright (c) Microsoft Corporation.

    Permission to use, copy, modify, and/or distribute this software for any
    purpose with or without fee is hereby granted.

    THE SOFTWARE IS PROVIDED "AS IS" AND THE AUTHOR DISCLAIMS ALL WARRANTIES WITH
    REGARD TO THIS SOFTWARE INCLUDING ALL IMPLIED WARRANTIES OF MERCHANTABILITY
    AND FITNESS. IN NO EVENT SHALL THE AUTHOR BE LIABLE FOR ANY SPECIAL, DIRECT,
    INDIRECT, OR CONSEQUENTIAL DAMAGES OR ANY DAMAGES WHATSOEVER RESULTING FROM
    LOSS OF USE, DATA OR PROFITS, WHETHER IN AN ACTION OF CONTRACT, NEGLIGENCE OR
    OTHER TORTIOUS ACTION, ARISING OUT OF OR IN CONNECTION WITH THE USE OR
    PERFORMANCE OF THIS SOFTWARE.
    ***************************************************************************** */var a=function(e,t){return(a=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)Object.prototype.hasOwnProperty.call(t,n)&&(e[n]=t[n])})(e,t)};function c(e,t,n,r){return new(n||(n=Promise))((function(i,o){function s(e){try{c(r.next(e))}catch(e){o(e)}}function a(e){try{c(r.throw(e))}catch(e){o(e)}}function c(e){var t;e.done?i(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(s,a)}c((r=r.apply(e,t||[])).next())}))}function u(e,t){var n,r,i,o,s={label:0,sent:function(){if(1&i[0])throw i[1];return i[1]},trys:[],ops:[]};return o={next:a(0),throw:a(1),return:a(2)},"function"==typeof Symbol&&(o[Symbol.iterator]=function(){return this}),o;function a(o){return function(a){return function(o){if(n)throw new TypeError("Generator is already executing.");for(;s;)try{if(n=1,r&&(i=2&o[0]?r.return:o[0]?r.throw||((i=r.return)&&i.call(r),0):r.next)&&!(i=i.call(r,o[1])).done)return i;switch(r=0,i&&(o=[2&o[0],i.value]),o[0]){case 0:case 1:i=o;break;case 4:return s.label++,{value:o[1],done:!1};case 5:s.label++,r=o[1],o=[0];continue;case 7:o=s.ops.pop(),s.trys.pop();continue;default:if(!(i=s.trys,(i=i.length>0&&i[i.length-1])||6!==o[0]&&2!==o[0])){s=0;continue}if(3===o[0]&&(!i||o[1]>i[0]&&o[1]<i[3])){s.label=o[1];break}if(6===o[0]&&s.label<i[1]){s.label=i[1],i=o;break}if(i&&s.label<i[2]){s.label=i[2],s.ops.push(o);break}i[2]&&s.ops.pop(),s.trys.pop();continue}o=t.call(e,s)}catch(e){o=[6,e],r=0}finally{n=i=0}if(5&o[0])throw o[1];return{value:o[0]?o[1]:void 0,done:!0}}([o,a])}}}Object.create;function p(e,t){var n="function"==typeof Symbol&&e[Symbol.iterator];if(!n)return e;var r,i,o=n.call(e),s=[];try{for(;(void 0===t||t-- >0)&&!(r=o.next()).done;)s.push(r.value)}catch(e){i={error:e}}finally{try{r&&!r.done&&(n=o.return)&&n.call(o)}finally{if(i)throw i.error}}return s}function h(){for(var e=[],t=0;t<arguments.length;t++)e=e.concat(p(arguments[t]));return e}Object.create;var l=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return function(e,t){function n(){this.constructor=e}a(e,t),e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)}(t,e),t.prototype.getScannerControls=function(){if(!this.scannerControls)throw new Error("No scanning is running at the time.");return this.scannerControls},t.prototype.scanFromDeviceObservable=function(e,t){var n;return c(this,void 0,void 0,(function(){var r,i,a,c=this;return u(this,(function(u){switch(u.label){case 0:r=new s.BehaviorSubject({}),u.label=1;case 1:return u.trys.push([1,3,,4]),[4,this.decodeFromVideoDevice(e,t,(function(e,t){if(t){var n=t.name;n===o.NotFoundException.name||n===o.ChecksumException.name||n===o.FormatException.name||t.message.includes("No MultiFormat Readers were able to detect the code.")?r.next({error:t}):(r.error(t),c.scannerControls.stop(),c.scannerControls=void 0)}else r.next({result:e})}))];case 2:return i=u.sent(),this.scannerControls=Object.assign(Object.assign({},i),{stop:function(){i.stop(),r.complete()}}),[3,4];case 3:return a=u.sent(),r.error(a),null===(n=this.scannerControls)||void 0===n||n.stop(),this.scannerControls=void 0,[3,4];case 4:return[2,r.asObservable()]}}))}))},t}(i.BrowserMultiFormatReader),d=function(){function e(){this.timeBetweenScans=500,this.delayBetweenScanSuccess=500,this.previewFitMode="cover",this._ready=!1,this.autostarted=new n.EventEmitter,this.autostarting=new n.EventEmitter,this.torchCompatible=new n.EventEmitter(!1),this.scanSuccess=new n.EventEmitter,this.scanFailure=new n.EventEmitter,this.scanError=new n.EventEmitter,this.scanComplete=new n.EventEmitter,this.camerasFound=new n.EventEmitter,this.camerasNotFound=new n.EventEmitter,this.permissionResponse=new n.EventEmitter(!0),this.hasDevices=new n.EventEmitter,this.deviceChange=new n.EventEmitter,this._enabled=!0,this._hints=new Map,this.autofocusEnabled=!0,this.autostart=!0,this.formats=[o.BarcodeFormat.QR_CODE],this.hasNavigator="undefined"!=typeof navigator,this.isMediaDevicesSupported=this.hasNavigator&&!!navigator.mediaDevices}return Object.defineProperty(e.prototype,"codeReader",{get:function(){return this._codeReader},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"device",{get:function(){return this._device},set:function(e){this._ready?this.isAutostarting?console.warn("Avoid setting a device during auto-start."):this.isCurrentDevice(e)?console.warn("Setting the same device is not allowed."):this.hasPermission?this.setDevice(e):console.warn("Permissions not set yet, waiting for them to be set to apply device change."):this._devicePreStart=e},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"formats",{get:function(){return this.hints.get(o.DecodeHintType.POSSIBLE_FORMATS)},set:function(e){var t=this;if("string"==typeof e)throw new Error("Invalid formats, make sure the [formats] input is a binding.");var n=e.map((function(e){return t.getBarcodeFormatOrFail(e)})),r=this.hints;r.set(o.DecodeHintType.POSSIBLE_FORMATS,n),this.hints=r},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"hints",{get:function(){return this._hints},set:function(e){var t;this._hints=e,null===(t=this.codeReader)||void 0===t||t.setHints(this._hints)},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"videoConstraints",{set:function(e){var t,n=null===(t=this.codeReader)||void 0===t?void 0:t.getScannerControls();n&&(null==n||n.streamVideoConstraintsApply(e))},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"isAutostarting",{get:function(){return this._isAutostarting},set:function(e){this._isAutostarting=e,this.autostarting.next(e)},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"torch",{set:function(e){try{this.getCodeReader().getScannerControls().switchTorch(e)}catch(e){}},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"enable",{set:function(e){this._enabled=Boolean(e),this._enabled?this.device?this.scanFromDevice(this.device.deviceId):this.init():this.reset()},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"enabled",{get:function(){return this._enabled},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"tryHarder",{get:function(){return this.hints.get(o.DecodeHintType.TRY_HARDER)},set:function(e){var t=this.hints;e?t.set(o.DecodeHintType.TRY_HARDER,!0):t.delete(o.DecodeHintType.TRY_HARDER),this.hints=t},enumerable:!1,configurable:!0}),e.prototype.askForPermission=function(){return c(this,void 0,void 0,(function(){var e,t,n;return u(this,(function(r){switch(r.label){case 0:if(!this.hasNavigator)return console.error("@zxing/ngx-scanner","Can't ask permission, navigator is not present."),this.setPermission(null),[2,this.hasPermission];if(!this.isMediaDevicesSupported)return console.error("@zxing/ngx-scanner","Can't get user media, this is not supported."),this.setPermission(null),[2,this.hasPermission];r.label=1;case 1:return r.trys.push([1,3,4,5]),[4,this.getAnyVideoDevice()];case 2:return e=r.sent(),t=!!e,[3,5];case 3:return n=r.sent(),[2,this.handlePermissionException(n)];case 4:return this.terminateStream(e),[7];case 5:return this.setPermission(t),[2,t]}}))}))},e.prototype.getAnyVideoDevice=function(){return navigator.mediaDevices.getUserMedia({video:!0})},e.prototype.terminateStream=function(e){e&&e.getTracks().forEach((function(e){return e.stop()})),e=void 0},e.prototype.init=function(){return c(this,void 0,void 0,(function(){return u(this,(function(e){switch(e.label){case 0:return this.autostart?[4,this.initAutostartOn()]:(console.warn("Feature 'autostart' disabled. Permissions and devices recovery has to be run manually."),this.initAutostartOff(),this._ready=!0,[2]);case 1:return e.sent(),this._ready=!0,[2]}}))}))},e.prototype.initAutostartOff=function(){this.isAutostarting=!1,this.updateVideoInputDevices(),this._device&&this._devicePreStart&&this.setDevice(this._devicePreStart)},e.prototype.initAutostartOn=function(){return c(this,void 0,void 0,(function(){var e,t,n;return u(this,(function(r){switch(r.label){case 0:this.isAutostarting=!0,r.label=1;case 1:return r.trys.push([1,3,,4]),[4,this.askForPermission()];case 2:return e=r.sent(),[3,4];case 3:return t=r.sent(),console.error("Exception occurred while asking for permission:",t),[2];case 4:return e?[4,this.updateVideoInputDevices()]:[3,7];case 5:return n=r.sent(),[4,this.autostartScanner(h(n))];case 6:r.sent(),r.label=7;case 7:return this.isAutostarting=!1,this.autostarted.next(),[2]}}))}))},e.prototype.isCurrentDevice=function(e){var t;return(null==e?void 0:e.deviceId)===(null===(t=this._device)||void 0===t?void 0:t.deviceId)},e.prototype.ngOnDestroy=function(){this.reset()},e.prototype.ngOnInit=function(){this.init()},e.prototype.scanStop=function(){var e,t;this._scanSubscription&&(null===(e=this.codeReader)||void 0===e||e.getScannerControls().stop(),null===(t=this._scanSubscription)||void 0===t||t.unsubscribe(),this._scanSubscription=void 0),this.torchCompatible.next(!1)},e.prototype.scanStart=function(){if(this._scanSubscription)throw new Error("There is already a scan proccess running.");if(!this._device)throw new Error("No device defined, cannot start scan, please define a device.");this.scanFromDevice(this._device.deviceId)},e.prototype.restart=function(){this._codeReader=void 0;var e=this._reset();e&&(this.device=e)},e.prototype.updateVideoInputDevices=function(){return c(this,void 0,void 0,(function(){var e,t;return u(this,(function(n){switch(n.label){case 0:return[4,i.BrowserCodeReader.listVideoInputDevices()];case 1:return e=n.sent()||[],t=e&&e.length>0,this.hasDevices.next(t),this.camerasFound.next(h(e)),t||this.camerasNotFound.next(),[2,e]}}))}))},e.prototype.autostartScanner=function(e){return c(this,void 0,void 0,(function(){var t,n;return u(this,(function(r){switch(r.label){case 0:if(t=function(e){var t=e.label;return/back|trás|rear|traseira|environment|ambiente/gi.test(t)},!(n=e.find(t)||e.pop()))throw new Error("Impossible to autostart, no input devices available.");return[4,this.setDevice(n)];case 1:return r.sent(),this.deviceChange.next(n),[2]}}))}))},e.prototype.dispatchScanSuccess=function(e){this.scanSuccess.next(e.getText())},e.prototype.dispatchScanFailure=function(e){this.scanFailure.next(e)},e.prototype.dispatchScanError=function(e){this.scanError.observers.some((function(e){return Boolean(e)}))||(console.error("zxing scanner component: "+e.name,e),console.warn("Use the `(scanError)` property to handle errors like this!")),this.scanError.next(e)},e.prototype.dispatchScanComplete=function(e){this.scanComplete.next(e)},e.prototype.handlePermissionException=function(e){var t;switch(console.error("@zxing/ngx-scanner","Error when asking for permission.",e),e.name){case"NotSupportedError":console.warn("@zxing/ngx-scanner",e.message),t=null,this.hasDevices.next(null);break;case"NotAllowedError":console.warn("@zxing/ngx-scanner",e.message),t=!1,this.hasDevices.next(!0);break;case"NotFoundError":console.warn("@zxing/ngx-scanner",e.message),t=null,this.hasDevices.next(!1),this.camerasNotFound.next(e);break;case"NotReadableError":console.warn("@zxing/ngx-scanner","Couldn't read the device(s)'s stream, it's probably in use by another app."),t=null,this.hasDevices.next(!1),this.camerasNotFound.next(e);break;default:console.warn("@zxing/ngx-scanner","I was not able to define if I have permissions for camera or not.",e),t=null}return this.setPermission(t),this.permissionResponse.error(e),t},e.prototype.getBarcodeFormatOrFail=function(e){return"string"==typeof e?o.BarcodeFormat[e.trim().toUpperCase()]:e},e.prototype.getCodeReader=function(){if(!this._codeReader){var e={delayBetweenScanAttempts:this.timeBetweenScans,delayBetweenScanSuccess:this.delayBetweenScanSuccess};this._codeReader=new l(this.hints,e)}return this._codeReader},e.prototype.scanFromDevice=function(e){return c(this,void 0,void 0,(function(){var t,n,r,i,o,s,a,c,p=this;return u(this,(function(u){switch(u.label){case 0:return t=this.previewElemRef.nativeElement,[4,(n=this.getCodeReader()).scanFromDeviceObservable(e,t)];case 1:if(!(r=u.sent()))throw new Error("Undefined decoding stream, aborting.");return i=function(e){return p._onDecodeResult(e.result,e.error)},o=function(e){return p._onDecodeError(e)},s=function(){},this._scanSubscription=r.subscribe(i,o,s),this._scanSubscription.closed?[2]:(a=n.getScannerControls(),c=void 0!==a.switchTorch,this.torchCompatible.next(c),[2])}}))}))},e.prototype._onDecodeError=function(e){this.dispatchScanError(e)},e.prototype._onDecodeResult=function(e,t){e?this.dispatchScanSuccess(e):this.dispatchScanFailure(t),this.dispatchScanComplete(e)},e.prototype._reset=function(){if(this._codeReader){var e=this._device;return this.device=void 0,this._codeReader=void 0,e}},e.prototype.reset=function(){this._reset(),this.deviceChange.emit(null)},e.prototype.setDevice=function(e){return c(this,void 0,void 0,(function(){return u(this,(function(t){switch(t.label){case 0:return this.scanStop(),this._device=e||void 0,this._device||i.BrowserCodeReader.cleanVideoSource(this.previewElemRef.nativeElement),this._enabled&&e?[4,this.scanFromDevice(e.deviceId)]:[3,2];case 1:t.sent(),t.label=2;case 2:return[2]}}))}))},e.prototype.setPermission=function(e){this.hasPermission=e,this.permissionResponse.next(e)},e}();d.decorators=[{type:n.Component,args:[{selector:"zxing-scanner",template:'<video #preview [style.object-fit]="previewFitMode">\r\n  <p>\r\n    Your browser does not support this feature, please try to upgrade it.\r\n  </p>\r\n  <p>\r\n    Seu navegador não suporta este recurso, por favor tente atualizá-lo.\r\n  </p>\r\n</video>\r\n',changeDetection:n.ChangeDetectionStrategy.OnPush,styles:[":host{display:block}video{-o-object-fit:contain;height:auto;object-fit:contain;width:100%}"]}]}],d.ctorParameters=function(){return[]},d.propDecorators={previewElemRef:[{type:n.ViewChild,args:["preview",{static:!0}]}],autofocusEnabled:[{type:n.Input}],timeBetweenScans:[{type:n.Input}],delayBetweenScanSuccess:[{type:n.Input}],autostarted:[{type:n.Output}],autostarting:[{type:n.Output}],autostart:[{type:n.Input}],previewFitMode:[{type:n.Input}],torchCompatible:[{type:n.Output}],scanSuccess:[{type:n.Output}],scanFailure:[{type:n.Output}],scanError:[{type:n.Output}],scanComplete:[{type:n.Output}],camerasFound:[{type:n.Output}],camerasNotFound:[{type:n.Output}],permissionResponse:[{type:n.Output}],hasDevices:[{type:n.Output}],device:[{type:n.Input}],deviceChange:[{type:n.Output}],formats:[{type:n.Input}],videoConstraints:[{type:n.Input}],torch:[{type:n.Input}],enable:[{type:n.Input}],tryHarder:[{type:n.Input}]};var f=function(){};f.decorators=[{type:n.NgModule,args:[{imports:[t.CommonModule,r.FormsModule],declarations:[d],exports:[d]}]}],e.ZXingScannerComponent=d,e.ZXingScannerModule=f,Object.defineProperty(e,"__esModule",{value:!0})}));
//# sourceMappingURL=zxing-ngx-scanner.umd.min.js.map